<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BlookDash | Version 28.0</title>
    <style>
        :root {
            --primary: #3498db; --dark-bg: #0b101b; --sidebar-bg: #161d2b;
            --card-bg: #1c2331; --danger: #e74c3c; --success: #2ecc71;
            --warning: #f1c40f; --chroma: #00FBFF; --exclusive: #ff0000;
            --epic: #a335ee; --legendary: #ff8000; --rare: #0070dd; --common: #ffffff;
        }

        body, html { margin: 0; padding: 0; height: 100%; font-family: 'Segoe UI', sans-serif; background: var(--dark-bg); color: white; overflow: hidden; }

        #sidebar { width: 240px; background: var(--sidebar-bg); height: 100vh; display: flex; flex-direction: column; padding: 20px; border-right: 2px solid #2c3e50; float: left; box-sizing: border-box; }
        .nav-btn { background: none; border: none; color: #bdc3c7; text-align: left; padding: 12px; font-size: 18px; cursor: pointer; border-radius: 8px; margin-bottom: 8px; width: 100%; transition: 0.2s; }
        .nav-btn.active { background: var(--primary); color: white; }
        #main-content { margin-left: 240px; padding: 30px; height: 100vh; overflow-y: auto; box-sizing: border-box; }

        .pack-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 20px; }
        .pack-card { background: var(--sidebar-bg); padding: 20px; border-radius: 15px; text-align: center; border: 2px solid #2c3e50; transition: 0.3s; }
        .pack-card:hover { border-color: var(--primary); }

        /* Chat Styling */
        .chat-container { display: flex; flex-direction: column; height: 400px; background: #000; border-radius: 10px; border: 1px solid #2c3e50; }
        #chat-display { flex: 1; overflow-y: auto; padding: 10px; font-size: 14px; }
        .chat-input-row { display: flex; padding: 10px; gap: 5px; border-top: 1px solid #2c3e50; }
        .msg-line { margin-bottom: 5px; border-bottom: 1px solid #111; padding-bottom: 2px; }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 50000; align-items: center; justify-content: center; flex-direction: column; }
        
        /* Animation Classes */
        .anim-common { animation: slideUp 0.4s ease-out; }
        .anim-epic { animation: zigZag 0.6s ease-in-out; }
        .anim-legendary { animation: bounceDrop 1s ease-in-out; }
        .anim-chroma { animation: spinFade 1s linear; }

        @keyframes slideUp { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes zigZag { 0% { transform: scale(0); } 25% { transform: translateX(-30px); } 75% { transform: translateX(30px); } 100% { transform: scale(1); } }
        @keyframes bounceDrop { 0% { transform: translateY(-400px); } 50% { transform: translateY(0); } 70% { transform: translateY(-60px); } 100% { transform: translateY(0); } }
        @keyframes spinFade { from { transform: rotate(0deg) scale(0); } to { transform: rotate(360deg) scale(1); } }
    </style>
</head>
<body onload="init()">

    <div id="splash-screen" style="position:fixed; width:100%; height:100%; background:#000; z-index:100; display:flex; flex-direction:column; align-items:center; justify-content:center;">
        <h1 style="font-size:70px; color:var(--primary);">BlookDash</h1>
        <button class="nav-btn" style="background:var(--success); color:white; width:200px; text-align:center;" onclick="openAuth()">ENTER</button>
    </div>

    <div id="auth-screen" class="modal">
        <div style="background:var(--sidebar-bg); padding:30px; border-radius:15px; width:300px; border:1px solid var(--primary);">
            <h2>Login / Sign Up</h2>
            <input type="text" id="user-input" placeholder="Username" style="width:100%; padding:10px; margin-bottom:10px; box-sizing:border-box;">
            <input type="password" id="pass-input" placeholder="Password" style="width:100%; padding:10px; margin-bottom:10px; box-sizing:border-box;">
            <button onclick="auth()" class="nav-btn" style="background:var(--primary); color:white; width:100%; text-align:center;">Launch</button>
        </div>
    </div>

    <div id="game-ui" style="display:none;">
        <div id="sidebar">
            <h2 style="color:var(--primary)">BlookDash</h2>
            <button class="nav-btn active" onclick="tab('market', this)">üõí Market</button>
            <button class="nav-btn" onclick="tab('community', this)">üí¨ Chat & Shop</button>
            <button class="nav-btn" onclick="tab('collection', this)">üéí Collection</button>
            <button class="nav-btn" onclick="tab('game-center', this)">üïπÔ∏è Games</button>
            
            <div style="margin-top:auto;">
                <button onclick="claimDaily()" id="daily-btn" class="nav-btn" style="background:var(--epic); color:white; text-align:center; font-size:14px;">üéÅ Claim Daily Reward</button>
                <p>TOKENS: <b id="stat-tokens" style="color:var(--warning)">0</b></p>
                <button onclick="location.reload()" class="nav-btn" style="background:var(--danger); color:white; text-align:center;">Logout</button>
            </div>
        </div>

        <div id="main-content">
            <div id="market" class="tab">
                <h1>Market</h1>
                <div id="pack-list" class="pack-grid"></div>
            </div>

            <div id="community" class="tab" style="display:none;">
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <h1>Global Chat</h1>
                        <div class="chat-container">
                            <div id="chat-display"></div>
                            <div class="chat-input-row">
                                <input type="text" id="chat-msg" placeholder="Type a message..." style="flex:1; padding:5px; background:#222; border:none; color:white;">
                                <button onclick="sendChat()" style="background:var(--primary); color:white; border:none; padding:5px 15px; cursor:pointer;">Send</button>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h1>List Community Blook</h1>
                        <div style="background:var(--card-bg); padding:15px; border-radius:10px;">
                            <input type="text" id="comm-name" placeholder="Blook Name" style="width:100%; margin-bottom:5px;">
                            <select id="comm-emoji" style="width:100%; margin-bottom:5px;">
                                <option value="ü¶ù">Raccoon</option><option value="üê≤">Dragon</option><option value="üíé">Diamond</option>
                            </select>
                            <input type="number" id="comm-price" placeholder="Price" style="width:100%; margin-bottom:5px;">
                            <button onclick="listCommunity()" class="nav-btn" style="background:var(--success); color:white; width:100%; text-align:center;">Post to Shop</button>
                        </div>
                        <div id="community-list" class="pack-grid" style="margin-top:10px;"></div>
                    </div>
                </div>
            </div>

            <div id="collection" class="tab" style="display:none;">
                <h1>Collection</h1>
                <div id="blook-list" class="pack-grid"></div>
            </div>

            <div id="game-center" class="tab" style="display:none; text-align:center;">
                <h1>Flappy Blook</h1>
                <canvas id="game-canvas" width="400" height="400"></canvas><br>
                <button onclick="resetGame()" class="nav-btn" style="background:var(--success); width:200px; display:inline-block; text-align:center;">Start Game</button>
            </div>
        </div>
    </div>

    <div id="reveal-modal" class="modal">
        <div id="reveal-container" style="text-align:center;">
            <div id="reveal-img" style="font-size:150px;"></div>
            <h1 id="reveal-name"></h1>
            <h2 id="reveal-rarity"></h2>
        </div>
        <button onclick="closeModal()" class="nav-btn" style="background:var(--primary); color:white; width:150px; margin-top:30px; text-align:center;">KEEP IT</button>
    </div>

    <script>
        let user = null;
        let data = { tokens: 5000n, inventory: [], pass: "", lastDaily: 0 };
        let chatHistory = [];
        let commItems = [];

        const packs = [
            { name: 'Starter Pack', icon: 'üì¶', cost: 10n, pool: [{name:'Slime', rarity:'Common', img:'üü¢'}, {name:'Golem', rarity:'Rare', img:'üóø'}] },
            { name: 'Elite Pack', icon: 'üíé', cost: 250n, pool: [{name:'Phoenix', rarity:'Epic', img:'üî•'}, {name:'Dragon', rarity:'Legendary', img:'üê≤'}] }
        ];

        function openAuth() { document.getElementById('auth-screen').style.display = 'flex'; }

        function auth() {
            user = document.getElementById('user-input').value.trim();
            let pass = document.getElementById('pass-input').value.trim();
            if(!user || !pass) return;

            const saved = JSON.parse(localStorage.getItem('bd_'+user));
            if(saved) {
                if(saved.pass !== pass) return alert("Incorrect Password");
                data.tokens = BigInt(saved.tokens);
                data.inventory = saved.inventory;
                data.lastDaily = saved.lastDaily || 0;
            } else { data.pass = pass; }

            // Load Global Chat
            const savedChat = JSON.parse(localStorage.getItem('bd_global_chat'));
            if(savedChat) chatHistory = savedChat;

            document.getElementById('splash-screen').style.display = 'none';
            document.getElementById('auth-screen').style.display = 'none';
            document.getElementById('game-ui').style.display = 'block';
            updateUI(); renderPacks(); renderChat();
        }

        /* DAILY REWARD */
        function claimDaily() {
            const now = Date.now();
            const cooldown = 24 * 60 * 60 * 1000; // 24 Hours
            if(now - data.lastDaily < cooldown) {
                const remaining = cooldown - (now - data.lastDaily);
                const hours = Math.floor(remaining / (1000 * 60 * 60));
                return alert(`Wait ${hours} more hours for your next reward!`);
            }
            data.tokens += 1000n;
            data.lastDaily = now;
            updateUI(); save();
            alert("1,000 Tokens added to your balance!");
        }

        /* CHAT LOGIC */
        function sendChat() {
            const msg = document.getElementById('chat-msg').value.trim();
            if(!msg) return;
            chatHistory.push({u: user, m: msg});
            if(chatHistory.length > 50) chatHistory.shift(); // Keep chat clean
            localStorage.setItem('bd_global_chat', JSON.stringify(chatHistory));
            document.getElementById('chat-msg').value = "";
            renderChat();
        }

        function renderChat() {
            const display = document.getElementById('chat-display');
            display.innerHTML = chatHistory.map(c => `
                <div class="msg-line"><b>${c.u}:</b> ${c.m}</div>
            `).join('');
            display.scrollTop = display.scrollHeight;
        }

        /* MARKET LOGIC */
        function renderPacks() {
            document.getElementById('pack-list').innerHTML = packs.map((p, i) => `
                <div class="pack-card">
                    <div style="font-size:50px;">${p.icon}</div>
                    <h3>${p.name}</h3>
                    <p>${p.cost.toLocaleString()} Tokens</p>
                    <button onclick="buyPack(${i}, 1)" style="padding:5px; cursor:pointer;">Open 1</button>
                    <button onclick="buyPack(${i}, 10)" style="padding:5px; cursor:pointer; background:var(--warning);">Spam 10</button>
                </div>`).join('');
        }

        function buyPack(i, amt) {
            let total = packs[i].cost * BigInt(amt);
            if(data.tokens < total) return alert("Not enough tokens!");
            data.tokens -= total;
            for(let a=0; a<amt; a++){
                let res = packs[i].pool[Math.floor(Math.random()*packs[i].pool.length)];
                data.inventory.unshift(res);
                if(amt === 1) showReveal(res);
            }
            updateUI(); save();
        }

        function listCommunity() {
            const n = document.getElementById('comm-name').value;
            const e = document.getElementById('comm-emoji').value;
            const p = BigInt(document.getElementById('comm-price').value || 0);
            if(!n || p <= 0n) return;
            commItems.push({name:n, img:e, price:p, seller:user});
            renderCommunity();
        }

        function renderCommunity() {
            document.getElementById('community-list').innerHTML = commItems.map((item, i) => `
                <div class="pack-card">
                    <div style="font-size:40px;">${item.img}</div>
                    <b>${item.name}</b><br><small>${item.seller}</small>
                    <p>${item.price.toLocaleString()} Tokens</p>
                    <button onclick="buyComm(${i})" style="cursor:pointer;">Buy</button>
                </div>`).join('');
        }

        function buyComm(i) {
            if(confirm(`Buy ${commItems[i].name}?`)) {
                if(data.tokens < commItems[i].price) return alert("Poor!");
                data.tokens -= commItems[i].price;
                data.inventory.unshift({name:commItems[i].name, img:commItems[i].img, rarity:'Community'});
                updateUI(); save();
            }
        }

        function showReveal(b) {
            const container = document.getElementById('reveal-container');
            container.className = ""; void container.offsetWidth;
            const r = b.rarity;
            if(r === 'Common' || r === 'Rare') container.classList.add('anim-common');
            else if(r === 'Epic') container.classList.add('anim-epic');
            else if(r === 'Legendary') container.classList.add('anim-legendary');
            else container.classList.add('anim-chroma');

            document.getElementById('reveal-modal').style.display = 'flex';
            document.getElementById('reveal-img').innerText = b.img;
            document.getElementById('reveal-name').innerText = b.name;
            document.getElementById('reveal-rarity').innerText = r;
            document.getElementById('reveal-rarity').style.color = `var(--${r.toLowerCase()})`;
        }

        function renderInv() {
            document.getElementById('blook-list').innerHTML = data.inventory.map((b, i) => `
                <div class="pack-card">
                    <div style="font-size:40px;">${b.img}</div>
                    <b>${b.name}</b><br><small>${b.rarity}</small><br>
                    <button onclick="sell(${i})" style="font-size:10px; color:var(--danger); border:none; background:none; cursor:pointer;">Sell (5 tokens)</button>
                </div>`).join('');
        }

        function sell(i) { data.inventory.splice(i, 1); data.tokens += 5n; renderInv(); updateUI(); save(); }

        function tab(id, btn) {
            document.querySelectorAll('.tab').forEach(t => t.style.display='none');
            document.getElementById(id).style.display='block';
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            if(id === 'collection') renderInv();
            if(id === 'community') renderCommunity();
        }

        function save() { localStorage.setItem('bd_'+user, JSON.stringify({tokens:data.tokens.toString(), inventory:data.inventory, pass:data.pass, lastDaily:data.lastDaily})); }
        function updateUI() { document.getElementById('stat-tokens').innerText = data.tokens.toLocaleString(); }
        function closeModal() { document.getElementById('reveal-modal').style.display = 'none'; }

        /* FLAPPY ENGINE */
        const cvs = document.getElementById('game-canvas');
        const ctx = cvs.getContext('2d');
        let bird, pipes, active = false;
        function resetGame() { bird = { x: 50, y: 200, v: 0, g: 0.25 }; pipes = []; active = true; }
        function gameLoop() {
            ctx.clearRect(0,0,400,400);
            if(active) {
                bird.v += bird.g; bird.y += bird.v;
                if(pipes.length === 0 || pipes[pipes.length-1].x < 240) pipes.push({x:400, y:Math.random()*180+60});
                pipes.forEach(p => {
                    p.x -= 2.5;
                    ctx.fillStyle = "#2ecc71";
                    ctx.fillRect(p.x, 0, 40, p.y);
                    ctx.fillRect(p.x, p.y+110, 40, 400);
                    if(bird.x+20 > p.x && bird.x < p.x+40 && (bird.y < p.y || bird.y+20 > p.y+110)) active = false;
                    if(p.x === 50) { data.tokens += 100n; updateUI(); }
                });
                if(bird.y > 400 || bird.y < 0) active = false;
                ctx.fillStyle = "#f1c40f"; ctx.fillRect(bird.x, bird.y, 20, 20);
            }
            requestAnimationFrame(gameLoop);
        }
        window.onkeydown = (e) => { if(e.code === "Space") { bird.v = -5.5; e.preventDefault(); } };
        function init() { gameLoop(); }
    </script>
</body>
</html>
